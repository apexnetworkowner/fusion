<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Game Embed Generator</title>
<style>
  body { font-family: Arial, sans-serif; margin:20px; background:#f5f5f5; }
  h2 { color:#4a148c; }
  label { font-weight:bold; margin-top:12px; display:block; }
  textarea, input { width:100%; padding:8px; margin-top:6px; border-radius:6px; border:1px solid #ccc; font-family:monospace; }
  button { margin-top:12px; padding:10px 16px; border:none; border-radius:6px; background:#4a148c; color:white; cursor:pointer; }
  button:hover { background:#6a1b9a; }
  #status { margin-top:10px; font-weight:bold; }
</style>
</head>
<body>
<h2>Game Embed Generator</h2>

<label for="gameHTML">Paste HTML Game Code:</label>
<textarea id="gameHTML" rows="10"></textarea>

<label for="password">Set Password:</label>
<input id="password" type="password">

<button id="generate">Generate Embed</button>
<div id="status"></div>

<h3>Iframe Embed Snippet</h3>
<textarea id="iframeSnippet" rows="6" readonly></textarea>
<button id="copyBtn">Copy</button>

<script>
// Helper: Base64 encode
function toBase64(str){
  return btoa(unescape(encodeURIComponent(str)));
}

// SHA-256 hash
async function hashPassword(password){
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(password));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function generateEmbed(){
  const html = document.getElementById("gameHTML").value.trim();
  const pass = document.getElementById("password").value.trim();
  const status = document.getElementById("status");

  if(!html || !pass){
    status.textContent = "⚠️ Fill in both fields!";
    return;
  }
  status.textContent = "⏳ Generating...";

  const hashed = await hashPassword(pass);
  const encodedGame = toBase64(html);

  // The protected HTML (will be embedded as data URL)
  const protectedHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Protected Game</title>
  <style>
    body { margin:0; display:flex; align-items:center; justify-content:center; height:100vh; background:#111; color:#fff; font-family:sans-serif; flex-direction:column; }
    button { padding:12px 20px; border:none; border-radius:6px; background:#4a148c; color:white; font-size:16px; cursor:pointer; margin:6px; }
    button:hover { background:#6a1b9a; }
  </style>
</head>
<body>
  <div id="screen">
    <h2>Enter Password to Unlock Game</h2>
    <button onclick="askPass()">Enter Password</button>
  </div>
<script>
const hash = "${hashed}";
const gameHTML = atob("${encodedGame}");

async function sha256(str){
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

function askPass(){
  const input = prompt("Enter password");
  sha256(input).then(h => {
    if(h === hash){
      document.body.innerHTML = '<button onclick="launchGame()">Launch Game</button>' +
                                '<button onclick="openFullscreen()">Fullscreen</button>' +
                                '<div id="gameContainer" style="width:100%;height:100%;"></div>';
    } else {
      alert("Wrong password!");
    }
  });
}

function launchGame(){
  const container = document.getElementById("gameContainer");
  const frame = document.createElement("iframe");
  frame.style = "border:0;width:100%;height:100%;";
  container.innerHTML = "";
  container.appendChild(frame);
  frame.contentWindow.document.open();
  frame.contentWindow.document.write(gameHTML);
  frame.contentWindow.document.close();
}

function openFullscreen(){
  const w = window.open("about:blank","_blank");
  w.document.write(gameHTML);
  w.document.close();
}
</script>
</body>
</html>`;

  const dataUrl = "data:text/html;base64," + toBase64(protectedHTML);
  const snippet = `<iframe src="${dataUrl}" style="width:100%;height:600px;border:0;"></iframe>`;

  document.getElementById("iframeSnippet").value = snippet;
  status.textContent = "✅ Embed generated!";
}

function copyEmbed(){
  const txt = document.getElementById("iframeSnippet").value;
  if(txt){
    navigator.clipboard.writeText(txt).then(()=>alert("Copied!"));
  }
}

document.getElementById("generate").addEventListener("click", generateEmbed);
document.getElementById("copyBtn").addEventListener("click", copyEmbed);
</script>
</body>
</html>
